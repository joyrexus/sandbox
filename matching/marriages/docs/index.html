<!DOCTYPE html>

<html>
<head>
  <title>index.py</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.py</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>the men and their list of ordered spousal preferences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>M = dict((m, prefs.split(<span class="string">', '</span>)) <span class="keyword">for</span> [m, prefs] <span class="keyword">in</span> (line.rstrip().split(<span class="string">': '</span>)
                                <span class="keyword">for</span> line <span class="keyword">in</span> open(<span class="string">'men.txt'</span>)))</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>the women and their list of ordered spousal preferences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>W = dict((m, prefs.split(<span class="string">', '</span>)) <span class="keyword">for</span> [m, prefs] <span class="keyword">in</span> (line.rstrip().split(<span class="string">': '</span>)
                                <span class="keyword">for</span> line <span class="keyword">in</span> open(<span class="string">'women.txt'</span>)))</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>check if a mapping of wives to husbands is stable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">def</span> <span class="title">is_stable</span><span class="params">(wives, verbose=False)</span>:</span>
    <span class="keyword">for</span> w, m <span class="keyword">in</span> wives.items():
        i = M[m].index(w)
        preferred = M[m][:i]
        <span class="keyword">for</span> p <span class="keyword">in</span> preferred:
            h = wives[p]
            <span class="keyword">if</span> W[p].index(m) &lt; W[p].index(h):
                msg = <span class="string">"{}'s marriage to {} is unstable: "</span> + \
                      <span class="string">"{} prefers {} over {} and {} prefers "</span> + \
                      <span class="string">"{} over her current husband {}"</span>
                <span class="keyword">if</span> verbose:
                    <span class="keyword">print</span> msg.format(m, w, m, p, w, p, m, h) 
                <span class="keyword">return</span> <span class="built_in">False</span>
    <span class="keyword">return</span> <span class="built_in">True</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>test whether w prefers m over h</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">def</span> <span class="title">prefers</span><span class="params">(w, m, h)</span>:</span>
    <span class="keyword">return</span> W[w].index(m) &lt; W[w].index(h)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>return the woman favored by m after w</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">def</span> <span class="title">after</span><span class="params">(m, w)</span>:</span>
    prefs = M[m]            <span class="comment"># m's ordered list of preferences</span>
    i = prefs.index(w) + <span class="number">1</span>  <span class="comment"># woman following w in list of prefs</span>
    <span class="keyword">return</span> prefs[i]</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>try to match all men with their next preferred spouse</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="keyword">def</span> <span class="title">match</span><span class="params">(men, next={}, wives={})</span>:</span>
    <span class="keyword">if</span> <span class="keyword">not</span> len(men): <span class="keyword">return</span> wives
    m, men = men[<span class="number">0</span>], men[<span class="number">1</span>:]
    w = next[m]                     <span class="comment"># next woman for m to propose to</span>
    next[m] = after(m, w)           <span class="comment"># woman after w in m's list of prefs</span>
    <span class="keyword">if</span> w <span class="keyword">in</span> wives:
        h = wives[w]                <span class="comment"># current husband</span>
        <span class="keyword">if</span> prefers(w, m, h):
            men.append(h)           <span class="comment"># husband becomes available again</span>
            wives[w] = m            <span class="comment"># w becomes wife of m</span>
        <span class="keyword">else</span>:
            men.append(m)           <span class="comment"># m remains unmarried</span>
    <span class="keyword">else</span>:
        wives[w] = m                <span class="comment"># w becomes wife of m</span>
    <span class="keyword">return</span> match(men, next, wives)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>a mapping from men to their top preferences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>top = dict((m, rank[<span class="number">0</span>]) <span class="keyword">for</span> m, rank <span class="keyword">in</span> M.items())</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>match men and women; returns a mapping of wives to husbands</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>wives = match(M.keys(), top)

<span class="keyword">assert</span> is_stable(wives)             <span class="comment"># should be a stable matching</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>swap the husbands of two wives, which should make the matching unstable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>wives[<span class="string">'fay'</span>], wives[<span class="string">'gay'</span>] = wives[<span class="string">'gay'</span>], wives[<span class="string">'fay'</span>]

<span class="keyword">assert</span> is_stable(wives) <span class="keyword">is</span> <span class="built_in">False</span>    <span class="comment"># should not be a stable matching</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>with the perturbed matching we find that gav&#39;s marriage to fay is unstable: 
gav prefers gay over fay and gay prefers gav over her current husband dan</p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
