<!DOCTYPE html>
<meta charset="utf-8">
<script src="lib/svg.js"></script>
<script src="lib/coffee-script.js"></script>
<body>
   <svg id="canvas" width="960" height="800">
    <path 
      class="line"
      fill="none" 
      stroke="steelblue"
      stroke-width="4"
      stroke-miterlimit="0"
      stroke-dasharray="628.035 628.035" 
      stroke-dashoffset="128.79"
      d="M192,354.901974927634L224,365.62566760306555C256,376.3493602784971,320,397.79674562936026,384,359.66860307380557C448,321.5404605182509,512,223.8367900562783,570,192.79610155957437C628,161.7554130628705,680,197.37770653143522,706,215.18885326571763L732,233"
    />
  </svg>
  <script type="text/coffeescript">
    path = document.querySelector('path')
    length = path.getTotalLength()

    # Clear any previous transition
    path.style.transition = path.style.WebkitTransition = 'none'

    # Set up the starting positions
    path.style.strokeDasharray = length + ' ' + length
    path.style.strokeDashoffset = length

    # Trigger a layout so styles are calculated & the browser
    # picks up the starting position before animating
    path.getBoundingClientRect()

    # Define our transition
    path.style.transition = path.style.WebkitTransition =
      'stroke-dashoffset 2s ease-in-out'

    out = false

    drawOut = -> 
      out = true
      path.style.strokeDasharray = length + ' ' + length
      path.style.strokeDashoffset = '0' 

    drawIn = -> 
      out = false
      path.style.strokeDashoffset = length - 20

    undo = ->
      if out then drawIn() else drawOut()

    canvas = document.getElementById("canvas")
    canvas.addEventListener('click', undo);

    # Go!
    drawOut()
  </script>
